<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthy Delights - Custom Meals</title>
    <style>
        :root {
            --primary-color: #ffd6e0; /* Light pink */
            --secondary-color: #ff85a2; /* Darker pink */
            --text-color: #333;
            --highlight-color: #ff4785;
            --success-color: #4CAF50;
            --error-color: #f44336;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff9fa;
            color: var(--text-color);
        }
        
        header {
            background-color: var(--primary-color);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--highlight-color);
            margin: 0;
        }
        
        .tagline {
            font-style: italic;
            color: var(--secondary-color);
            margin-top: 5px;
        }
        
        .main-menu {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
        }
        
        .menu-option {
            background-color: white;
            border-radius: 10px;
            width: 300px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .menu-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .menu-option img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .menu-option h2 {
            color: var(--highlight-color);
            margin-top: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: none; /* Initially hidden */
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .customizer-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        .summary-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .back-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-btn:hover {
            background-color: var(--highlight-color);
        }
        
        .category {
            margin-bottom: 20px;
        }
        
        .category h3 {
            color: var(--highlight-color);
            margin-bottom: 10px;
        }
        
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .option {
            background-color: var(--primary-color);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .option:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .option.selected {
            background-color: var(--highlight-color);
            color: white;
        }
        
        .remove-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
            padding: 0;
            margin-left: 5px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid var(--primary-color);
        }
        
        .calorie-info {
            font-size: 0.8rem;
            color: #666;
        }
        
        .nutrition-info {
            font-size: 0.7rem;
            color: #888;
            margin-top: 3px;
        }
        
        .price {
            color: var(--highlight-color);
            font-weight: bold;
        }
        
        .checkout-btn {
            background-color: var(--highlight-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .checkout-btn:hover {
            background-color: #e03c73;
        }
        
        .checkout-section {
            display: none;
            max-width: 600px;
            margin: 30px auto;
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        .checkout-section h2 {
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }
        
        .order-summary {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .success-message h2 {
            color: var(--success-color);
        }
        
        .success-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 20px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--primary-color);
            margin-top: 40px;
            font-size: 0.9rem;
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }
        
        .error {
            border-color: var(--error-color) !important;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
        }
        .order-history-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .order-history-btn:hover {
            background-color: var(--highlight-color);
        }

        .order-history-section {
            display: none;
            max-width: 800px;
            margin: 30px auto;
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .order-history-section h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .order-history-item {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .order-history-item h3 {
            color: var(--highlight-color);
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .order-history-item p {
            margin: 5px 0;
        }

        .order-history-item .price {
            color: var(--highlight-color);
            font-weight: bold;
        }

        .no-orders {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        /* Auth Section Styles */
        .auth-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .auth-container {
            background-color: white;
            border-radius: 10px;
            width: 400px;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        .auth-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 20px;
        }
        
        .auth-toggle a {
            color: var(--highlight-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .auth-toggle a:hover {
            text-decoration: underline;
        }
        
        .auth-btn {
            background-color: var(--highlight-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .auth-btn:hover {
            background-color: #e03c73;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }
        
        .logout-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            background-color: var(--highlight-color);
        }
        
        /* Cart Styles */
        .cart-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--highlight-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .cart-btn:hover {
            background-color: #e03c73;
        }
        
        .cart-count {
            background-color: white;
            color: var(--highlight-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .cart-section {
            display: none;
            max-width: 800px;
            margin: 30px auto;
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        .cart-section h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-details {
            font-size: 0.9rem;
            color: #666;
        }
        
        .cart-item-price {
            font-weight: bold;
            color: var(--highlight-color);
            margin-left: 20px;
        }
        
        .cart-item-remove {
            background-color: var(--error-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 15px;
        }
        
        .cart-total {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
        }
        
        .cart-empty {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 30px 0;
        }
        
        .cart-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .cart-actions button {
            flex: 1;
        }
        
        .add-to-cart-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .add-to-cart-btn:hover {
            background-color: var(--highlight-color);
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <header>
        <h1 class="logo">Healthy Delights</h1>
        <p class="tagline">Customize your perfect healthy meal!</p>
        <div class="user-info" id="user-info" style="display: none;">
            <span id="username-display"></span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <button class="cart-btn" id="cart-btn" onclick="showCart()" style="display: none;">
            <span>Cart</span>
            <span class="cart-count" id="cart-count">0</span>
        </button>
    </header>
    
    <!-- Auth Section (Login/Signup) -->
    <section class="auth-section" id="auth-section">
        <div class="auth-container">
            <div id="login-form">
                <h2>Login</h2>
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                    <div class="error-message" id="login-email-error">Please enter a valid email</div>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                    <div class="error-message" id="login-password-error">Please enter your password</div>
                </div>
                <button class="auth-btn" onclick="login()">Login</button>
                <div class="auth-toggle">
                    Don't have an account? <a onclick="showSignup()">Sign up</a>
                </div>
            </div>
            
            <div id="signup-form" style="display: none;">
                <h2>Sign Up</h2>
                <div class="form-group">
                    <label for="signup-name">Full Name</label>
                    <input type="text" id="signup-name" required>
                    <div class="error-message" id="signup-name-error">Please enter your name</div>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" required>
                    <div class="error-message" id="signup-email-error">Please enter a valid email</div>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" required>
                    <div class="error-message" id="signup-password-error">Password must be at least 6 characters</div>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" required>
                    <div class="error-message" id="signup-confirm-password-error">Passwords don't match</div>
                </div>
                <button class="auth-btn" onclick="signup()">Sign Up</button>
                <div class="auth-toggle">
                    Already have an account? <a onclick="showLogin()">Login</a>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Main Content (Hidden until logged in) -->
    <div id="main-content" style="display: none;">
        <!-- Main Menu -->
        <section class="main-menu" id="main-menu">
            <div class="menu-option" data-option="smoothie">
                <img src="https://images.unsplash.com/photo-1505252585461-04db1eb84625?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80" alt="Smoothie">
                <h2>Custom Smoothie</h2>
                <p>Create your perfect blend of fruits and superfoods</p>
            </div>
            
            <div class="menu-option" data-option="proteinShake">
                <img src="https://images.unsplash.com/photo-1535914254981-b5012eebbd15?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80" alt="Protein Shake">
                <h2>Protein Shake</h2>
                <p>Power up with your choice of protein and mix-ins</p>
            </div>
            
            <div class="menu-option" data-option="salad">
                <img src="https://images.unsplash.com/photo-1546793665-c74683f339c1?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80" alt="Salad">
                <h2>Custom Salad</h2>
                <p>Build your ideal salad with fresh ingredients</p>
            </div>
        </section>
        
        <!-- Smoothie Customizer -->
        <div class="container" id="smoothie-customizer">
            <button class="back-btn" onclick="backToMenu()">← Back to Menu</button>
            <section class="customizer-section">
                <h2>Build Your Smoothie</h2>
                
                <div class="category">
                    <h3>Base Fruits (Rp5,000 each)</h3>
                    <p class="calorie-info">Select 1-2 base fruits for your smoothie foundation</p>
                    <div class="options" id="smoothie-baseFruits"></div>
                </div>
                
                <div class="category">
                    <h3>Add-In Fruits (Rp5,500 each)</h3>
                    <p class="calorie-info">Enhance your smoothie with these delicious options</p>
                    <div class="options" id="smoothie-addInFruits"></div>
                </div>
                
                <div class="category">
                    <h3>Superfood Boosters (Rp7,000 each)</h3>
                    <p class="calorie-info">Power up your smoothie with these nutrient-packed options</p>
                    <div class="options" id="smoothie-superfoods"></div>
                </div>
                
                <div class="category">
                    <h3>Liquids (Rp10,000 each)</h3>
                    <p class="calorie-info">Choose your preferred liquid base</p>
                    <div class="options" id="smoothie-liquids"></div>
                </div>
            </section>
            
            <section class="summary-section">
                <h2>Your Smoothie</h2>
                <div id="smoothie-summary">
                    <p>Select ingredients to build your smoothie</p>
                </div>
                <div id="smoothie-nutrition"></div>
                <div class="total">
                    <span>Total:</span>
                    <span id="smoothie-total-price" class="price">Rp0</span>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('smoothie')">Add to Cart</button>
                <button class="checkout-btn" onclick="showCheckout('smoothie')">Checkout Now</button>
            </section>
        </div>
        
        <!-- Protein Shake Customizer -->
        <div class="container" id="proteinShake-customizer">
            <button class="back-btn" onclick="backToMenu()">← Back to Menu</button>
            <section class="customizer-section">
                <h2>Build Your Protein Shake</h2>
                
                <div class="category">
                    <h3>Protein Base (Rp19,000 each)</h3>
                    <p class="calorie-info">Select your protein foundation</p>
                    <div class="options" id="proteinShake-proteinBase"></div>
                </div>
                
                <div class="category">
                    <h3>Flavor Enhancers (Rp2,000 each)</h3>
                    <p class="calorie-info">Add flavor to your protein shake</p>
                    <div class="options" id="proteinShake-flavors"></div>
                </div>
                
                <div class="category">
                    <h3>Fruit Mix-Ins (Rp5,500 each)</h3>
                    <p class="calorie-info">Add fresh fruits to your shake</p>
                    <div class="options" id="proteinShake-fruits"></div>
                </div>
                
                <div class="category">
                    <h3>Healthy Fats (Rp8,000 each)</h3>
                    <p class="calorie-info">Boost your shake with healthy fats</p>
                    <div class="options" id="proteinShake-fats"></div>
                </div>
            </section>
            
            <section class="summary-section">
                <h2>Your Protein Shake</h2>
                <div id="proteinShake-summary">
                    <p>Select ingredients to build your protein shake</p>
                </div>
                <div id="proteinShake-nutrition"></div>
                <div class="total">
                    <span>Total:</span>
                    <span id="proteinShake-total-price" class="price">Rp0</span>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('proteinShake')">Add to Cart</button>
                <button class="checkout-btn" onclick="showCheckout('proteinShake')">Checkout Now</button>
            </section>
        </div>
        
        <!-- Salad Customizer -->
        <div class="container" id="salad-customizer">
            <button class="back-btn" onclick="backToMenu()">← Back to Menu</button>
            <section class="customizer-section">
                <h2>Build Your Salad</h2>
                
                <div class="category">
                    <h3>Greens Base (Rp8,000 each)</h3>
                    <p class="calorie-info">Select your salad foundation</p>
                    <div class="options" id="salad-greens"></div>
                </div>
                
                <div class="category">
                    <h3>Proteins (Rp8,000-Rp20,000)</h3>
                    <p class="calorie-info">Add protein to your salad</p>
                    <div class="options" id="salad-proteins"></div>
                </div>
                
                <div class="category">
                    <h3>Vegetables (Rp5,000 each)</h3>
                    <p class="calorie-info">Add fresh vegetables</p>
                    <div class="options" id="salad-vegetables"></div>
                </div>
                
                <div class="category">
                    <h3>Toppings (Rp6,000-Rp8,000)</h3>
                    <p class="calorie-info">Add delicious toppings</p>
                    <div class="options" id="salad-toppings"></div>
                </div>
                
                <div class="category">
                    <h3>Dressings (Rp4,000-Rp5,000)</h3>
                    <p class="calorie-info">Choose your dressing</p>
                    <div class="options" id="salad-dressings"></div>
                </div>
            </section>
            
            <section class="summary-section">
                <h2>Your Salad</h2>
                <div id="salad-summary">
                    <p>Select ingredients to build your salad</p>
                </div>
                <div id="salad-nutrition"></div>
                <div class="total">
                    <span>Total:</span>
                    <span id="salad-total-price" class="price">Rp0</span>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('salad')">Add to Cart</button>
                <button class="checkout-btn" onclick="showCheckout('salad')">Checkout Now</button>
            </section>
        </div>
        
        <!-- Cart Section -->
        <div class="cart-section" id="cart-section">
            <h2>Your Cart</h2>
            <div id="cart-items">
                <!-- Cart items will be inserted here -->
            </div>
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total-price" class="price">Rp0</span>
            </div>
            <div class="cart-actions">
                <button class="back-btn" onclick="backToMenu()">← Continue Shopping</button>
                <button class="checkout-btn" onclick="checkoutFromCart()">Proceed to Checkout</button>
            </div>
        </div>
        
        <!-- Checkout Section -->
        <div class="checkout-section" id="checkout-section">
            <h2>Checkout</h2>
            <div class="order-summary" id="order-summary">
                <!-- Order summary will be inserted here -->
            </div>
            
            <form id="checkout-form">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" required>
                    <div class="error-message" id="name-error">Please enter your full name</div>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                    <div class="error-message" id="email-error">Please enter a valid email address</div>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" required>
                    <div class="error-message" id="phone-error">Please enter a valid phone number (10 digits minimum)</div>
                </div>
                
                <div class="form-group">
                    <label for="address">Delivery Address</label>
                    <input type="text" id="address" required>
                    <div class="error-message" id="address-error">Please enter your delivery address</div>
                </div>
                
                <div class="form-group">
                    <label for="payment">Payment Method</label>
                    <select id="payment" required>
                        <option value="">Select payment method</option>
                        <option value="credit">Credit Card</option>
                        <option value="debit">Debit Card</option>
                        <option value="cash">Cash on Delivery</option>
                        <option value="gopay">GoPay</option>
                        <option value="ovo">OVO</option>
                    </select>
                    <div class="error-message" id="payment-error">Please select a payment method</div>
                </div>
                
                <button type="button" class="checkout-btn" onclick="submitOrder()">Place Order</button>
            </form>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="success-message">
            <div class="success-icon">✓</div>
            <h2>Order Placed Successfully!</h2>
            <p>Thank you for your order. We're preparing your meal now.</p>
            <p>An email confirmation has been sent to your inbox.</p>
            <button class="checkout-btn" onclick="backToMenu()">Back to Menu</button>
        </div>
        
        <!-- Order History Section -->
        <div class="order-history-section" id="order-history-section">
            <h2>Your Order History</h2>
            <div id="order-history-list">
                <!-- Order history items will be inserted here -->
            </div>
            <button class="back-btn" onclick="backToMenu()">← Back to Menu</button>
        </div>
        
        <button class="order-history-btn" onclick="showOrderHistory()">View Order History</button>
    </div>
    
    <footer>
        <p>&copy; 2023 Healthy Delights. All rights reserved.</p>
        <p>Fresh, healthy, and delicious meals made just for you!</p>
    </footer>

    <script>
        // User data and authentication
        let users = [
            // Sample user for testing
            {
                email: "user@example.com",
                password: "password123",
                name: "Test User",
                orders: []
            }
        ];
        
        let currentUser = null;
        let orderHistory = [];
        let cart = [];
        
        // Format price to IDR
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(price).replace(/\D00(?=\D*$)/, '');
        }
        
        // Ingredients data (prices in IDR) with nutritional information
        const ingredientsData = {
            smoothie: {
                baseFruits: [
                    { 
                        name: "Banana", 
                        calories: 105, 
                        price: 5000,
                        protein: 1.3,
                        sugar: 14,
                        benefits: "Rich in potassium, vitamin B6, and fiber. Helps regulate blood pressure and digestion."
                    },
                    { 
                        name: "Mango", 
                        calories: 99, 
                        price: 5000,
                        protein: 1.4,
                        sugar: 22,
                        benefits: "High in vitamins A and C. Supports immune function and eye health."
                    },
                    { 
                        name: "Pineapple", 
                        calories: 82, 
                        price: 5000,
                        protein: 0.9,
                        sugar: 16,
                        benefits: "Contains bromelain enzyme that aids digestion. Rich in vitamin C and manganese."
                    },
                    { 
                        name: "Apple", 
                        calories: 95, 
                        price: 5000,
                        protein: 0.5,
                        sugar: 19,
                        benefits: "High in fiber and antioxidants. May help lower cholesterol and reduce risk of diabetes."
                    },
                    { 
                        name: "Peach", 
                        calories: 59, 
                        price: 5000,
                        protein: 1.4,
                        sugar: 13,
                        benefits: "Good source of vitamins A and C. Contains antioxidants that may help reduce inflammation."
                    }
                ],
                addInFruits: [
                    { 
                        name: "Strawberry", 
                        calories: 49, 
                        price: 5500,
                        protein: 1,
                        sugar: 7,
                        benefits: "Excellent source of vitamin C and manganese. Contains antioxidants that may reduce oxidative stress."
                    },
                    { 
                        name: "Blueberry", 
                        calories: 84, 
                        price: 5500,
                        protein: 1.1,
                        sugar: 15,
                        benefits: "Packed with antioxidants. May improve brain function and reduce DNA damage."
                    },
                    { 
                        name: "Raspberry", 
                        calories: 65, 
                        price: 5500,
                        protein: 1.5,
                        sugar: 5,
                        benefits: "High in fiber and antioxidants. May help with blood sugar control."
                    },
                    { 
                        name: "Kiwi", 
                        calories: 42, 
                        price: 5500,
                        protein: 0.8,
                        sugar: 6,
                        benefits: "Rich in vitamin C and K. Contains enzymes that aid digestion."
                    },
                    { 
                        name: "Orange", 
                        calories: 62, 
                        price: 5500,
                        protein: 1.2,
                        sugar: 12,
                        benefits: "Excellent source of vitamin C. Supports immune function and skin health."
                    },
                    { 
                        name: "Avocado", 
                        calories: 160, 
                        price: 5500,
                        protein: 2,
                        sugar: 0.7,
                        benefits: "Rich in healthy monounsaturated fats. High in fiber, potassium, and vitamins K, E, and C."
                    }
                ],
                superfoods: [
                    { 
                        name: "Chia Seeds", 
                        calories: 138, 
                        price: 7000,
                        protein: 4.7,
                        sugar: 0,
                        benefits: "Rich in omega-3 fatty acids, fiber, and antioxidants. May improve heart health and digestion."
                    },
                    { 
                        name: "Flax Seeds", 
                        calories: 55, 
                        price: 7000,
                        protein: 1.9,
                        sugar: 0.2,
                        benefits: "High in fiber and omega-3 fatty acids. May help reduce cholesterol and blood pressure."
                    },
                    { 
                        name: "Spirulina", 
                        calories: 20, 
                        price: 7000,
                        protein: 4,
                        sugar: 0.3,
                        benefits: "Rich in protein, B vitamins, and antioxidants. May boost immunity and reduce inflammation."
                    },
                    { 
                        name: "Wheatgrass", 
                        calories: 15, 
                        price: 7000,
                        protein: 1,
                        sugar: 0,
                        benefits: "Contains chlorophyll, vitamins, minerals and enzymes. May help detoxify the body."
                    },
                    { 
                        name: "Acai", 
                        calories: 70, 
                        price: 7000,
                        protein: 1,
                        sugar: 2,
                        benefits: "Packed with antioxidants. May improve cholesterol levels and brain function."
                    }
                ],
                liquids: [
                    { 
                        name: "Almond Milk", 
                        calories: 30, 
                        price: 10000,
                        protein: 1,
                        sugar: 0,
                        benefits: "Low in calories, rich in vitamin E. Dairy-free alternative that's heart healthy."
                    },
                    { 
                        name: "Coconut Water", 
                        calories: 46, 
                        price: 10000,
                        protein: 1.7,
                        sugar: 6,
                        benefits: "Natural source of electrolytes like potassium. Helps with hydration."
                    },
                    { 
                        name: "Oat Milk", 
                        calories: 120, 
                        price: 10000,
                        protein: 3,
                        sugar: 7,
                        benefits: "Rich in fiber and beta-glucans. May help lower cholesterol."
                    },
                    { 
                        name: "Greek Yogurt", 
                        calories: 100, 
                        price: 10000,
                        protein: 10,
                        sugar: 4,
                        benefits: "High in protein and probiotics. Supports gut health and muscle recovery."
                    }
                ]
            },
            proteinShake: {
                proteinBase: [
                    { 
                        name: "Whey Protein", 
                        calories: 120, 
                        price: 19000,
                        protein: 24,
                        sugar: 1,
                        benefits: "Complete protein with all essential amino acids. Fast absorption for muscle recovery."
                    },
                    { 
                        name: "Plant Protein", 
                        calories: 110, 
                        price: 19000,
                        protein: 20,
                        sugar: 0,
                        benefits: "Vegan-friendly protein blend. Easily digestible and hypoallergenic."
                    },
                    { 
                        name: "Casein Protein", 
                        calories: 130, 
                        price: 19000,
                        protein: 26,
                        sugar: 2,
                        benefits: "Slow-digesting protein. Ideal for sustained muscle recovery overnight."
                    },
                    { 
                        name: "Collagen Peptides", 
                        calories: 70, 
                        price: 19000,
                        protein: 18,
                        sugar: 0,
                        benefits: "Supports skin, hair, nails and joint health. May improve gut health."
                    }
                ],
                flavors: [
                    { 
                        name: "Vanilla", 
                        calories: 50, 
                        price: 2000,
                        protein: 0,
                        sugar: 5,
                        benefits: "Natural vanilla flavor with minimal sugar. Adds sweetness without artificial ingredients."
                    },
                    { 
                        name: "Chocolate", 
                        calories: 60, 
                        price: 2000,
                        protein: 1,
                        sugar: 4,
                        benefits: "Rich in antioxidants from cocoa. May improve mood and brain function."
                    },
                    { 
                        name: "Strawberry", 
                        calories: 45, 
                        price: 2000,
                        protein: 0,
                        sugar: 6,
                        benefits: "Natural fruit flavor. Contains vitamin C and antioxidants."
                    },
                    { 
                        name: "Matcha", 
                        calories: 30, 
                        price: 2000,
                        protein: 1,
                        sugar: 0,
                        benefits: "Rich in antioxidants and provides gentle caffeine boost. May enhance focus."
                    }
                ],
                fruits: [
                    { 
                        name: "Banana", 
                        calories: 105, 
                        price: 5500,
                        protein: 1.3,
                        sugar: 14,
                        benefits: "Adds natural sweetness and creaminess. Rich in potassium and fiber."
                    },
                    { 
                        name: "Berries Mix", 
                        calories: 80, 
                        price: 5500,
                        protein: 1,
                        sugar: 10,
                        benefits: "Blend of antioxidants and fiber. Low glycemic index for sustained energy."
                    },
                    { 
                        name: "Mango", 
                        calories: 99, 
                        price: 5500,
                        protein: 1.4,
                        sugar: 22,
                        benefits: "Tropical flavor with vitamins A and C. Supports immune function."
                    },
                    { 
                        name: "Peanut Butter", 
                        calories: 190, 
                        price: 5500,
                        protein: 8,
                        sugar: 3,
                        benefits: "Adds healthy fats and protein. Rich in niacin, magnesium and vitamin E."
                    }
                ],
                fats: [
                    { 
                        name: "Almond Butter", 
                        calories: 180, 
                        price: 8000,
                        protein: 7,
                        sugar: 1,
                        benefits: "Rich in healthy monounsaturated fats, vitamin E and magnesium. Supports heart health."
                    },
                    { 
                        name: "Flaxseed Oil", 
                        calories: 120, 
                        price: 8000,
                        protein: 0,
                        sugar: 0,
                        benefits: "Excellent source of omega-3 fatty acids. May reduce inflammation."
                    },
                    { 
                        name: "Avocado", 
                        calories: 160, 
                        price: 8000,
                        protein: 2,
                        sugar: 0.7,
                        benefits: "Creamy texture with heart-healthy fats. Rich in fiber and potassium."
                    },
                    { 
                        name: "Coconut Cream", 
                        calories: 150, 
                        price: 8000,
                        protein: 1,
                        sugar: 3,
                        benefits: "Adds rich texture and medium-chain triglycerides that may boost metabolism."
                    }
                ]
            },
            salad: {
                greens: [
                    { 
                        name: "Mixed Greens", 
                        calories: 15, 
                        price: 8000,
                        protein: 1,
                        sugar: 0,
                        benefits: "Variety of leafy greens packed with vitamins A, C, K and folate. Low in calories."
                    },
                    { 
                        name: "Spinach", 
                        calories: 20, 
                        price: 8000,
                        protein: 2,
                        sugar: 0,
                        benefits: "Rich in iron, calcium and antioxidants. Supports bone health and immunity."
                    },
                    { 
                        name: "Kale", 
                        calories: 30, 
                        price: 8000,
                        protein: 2,
                        sugar: 0,
                        benefits: "Superfood green loaded with vitamins A, K and C. Contains cancer-fighting compounds."
                    },
                    { 
                        name: "Arugula", 
                        calories: 25, 
                        price: 8000,
                        protein: 2.6,
                        sugar: 0,
                        benefits: "Peppery flavor rich in calcium, potassium and folate. May support bone health."
                    }
                ],
                proteins: [
                    { 
                        name: "Grilled Chicken", 
                        calories: 200, 
                        price: 15000,
                        protein: 31,
                        sugar: 0,
                        benefits: "Lean protein source. Rich in B vitamins and selenium. Supports muscle growth."
                    },
                    { 
                        name: "Salmon", 
                        calories: 220, 
                        price: 20000,
                        protein: 25,
                        sugar: 0,
                        benefits: "Excellent source of omega-3 fatty acids. Supports heart and brain health."
                    },
                    { 
                        name: "Tofu", 
                        calories: 150, 
                        price: 12000,
                        protein: 16,
                        sugar: 1,
                        benefits: "Plant-based protein rich in calcium and iron. Contains all essential amino acids."
                    },
                    { 
                        name: "Hard Boiled Eggs", 
                        calories: 140, 
                        price: 8000,
                        protein: 12,
                        sugar: 0.6,
                        benefits: "Complete protein with essential amino acids. Rich in choline for brain health."
                    }
                ],
                vegetables: [
                    { 
                        name: "Tomatoes", 
                        calories: 25, 
                        price: 5000,
                        protein: 1,
                        sugar: 3,
                        benefits: "Rich in lycopene, an antioxidant that may reduce cancer risk. Good source of vitamin C."
                    },
                    { 
                        name: "Cucumbers", 
                        calories: 15, 
                        price: 5000,
                        protein: 0.6,
                        sugar: 1,
                        benefits: "High water content helps with hydration. Contains antioxidants and supports digestion."
                    },
                    { 
                        name: "Bell Peppers", 
                        calories: 30, 
                        price: 5000,
                        protein: 1,
                        sugar: 2,
                        benefits: "Excellent source of vitamin C. Different colors provide different antioxidants."
                    },
                    { 
                        name: "Red Onion", 
                        calories: 20, 
                        price: 5000,
                        protein: 0.5,
                        sugar: 2,
                        benefits: "Contains quercetin, an antioxidant with anti-inflammatory properties. May support heart health."
                    },
                    { 
                        name: "Carrots", 
                        calories: 25, 
                        price: 5000,
                        protein: 0.6,
                        sugar: 3,
                        benefits: "Rich in beta-carotene which converts to vitamin A. Supports eye health and immunity."
                    }
                ],
                toppings: [
                    { 
                        name: "Feta Cheese", 
                        calories: 80, 
                        price: 8000,
                        protein: 4,
                        sugar: 0,
                        benefits: "Adds tangy flavor with calcium and protein. Lower in fat than many cheeses."
                    },
                    { 
                        name: "Walnuts", 
                        calories: 180, 
                        price: 7000,
                        protein: 4,
                        sugar: 0,
                        benefits: "Rich in omega-3 fatty acids. May improve brain function and heart health."
                    },
                    { 
                        name: "Croutons", 
                        calories: 120, 
                        price: 7000,
                        protein: 3,
                        sugar: 1,
                        benefits: "Adds crunch and carbohydrates for energy. Choose whole grain for extra fiber."
                    },
                    { 
                        name: "Sunflower Seeds", 
                        calories: 160, 
                        price: 6000,
                        protein: 6,
                        sugar: 1,
                        benefits: "Excellent source of vitamin E and selenium. Supports skin health and immunity."
                    }
                ],
                dressings: [
                    { 
                        name: "Balsamic Vinaigrette", 
                        calories: 90, 
                        price: 4000,
                        protein: 0,
                        sugar: 4,
                        benefits: "Contains antioxidants from balsamic vinegar. May help regulate blood sugar."
                    },
                    { 
                        name: "Ranch", 
                        calories: 140, 
                        price: 5000,
                        protein: 1,
                        sugar: 2,
                        benefits: "Creamy dressing with herbs. Contains calcium from dairy ingredients."
                    },
                    { 
                        name: "Lemon Tahini", 
                        calories: 100, 
                        price: 4000,
                        protein: 3,
                        sugar: 1,
                        benefits: "Made with sesame seeds rich in calcium and healthy fats. Bright lemon flavor."
                    },
                    { 
                        name: "Olive Oil & Vinegar", 
                        calories: 120, 
                        price: 5000,
                        protein: 0,
                        sugar: 0,
                        benefits: "Heart-healthy monounsaturated fats from olive oil. May reduce inflammation."
                    }
                ]
            }
        };

        // Selected ingredients for each category
        let selectedItems = {
            smoothie: {
                baseFruits: [],
                addInFruits: [],
                superfoods: [],
                liquids: []
            },
            proteinShake: {
                proteinBase: [],
                flavors: [],
                fruits: [],
                fats: []
            },
            salad: {
                greens: [],
                proteins: [],
                vegetables: [],
                toppings: [],
                dressings: []
            }
        };

        // Current order type
        let currentOrderType = '';
        let currentOrder = {};

        // Initialize the app
        function init() {
            // Check if user is already logged in (from localStorage)
            const storedUser = localStorage.getItem('healthyDelightsUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                showMainContent();
            }
            
            // Load cart from localStorage
            const storedCart = localStorage.getItem('healthyDelightsCart');
            if (storedCart) {
                cart = JSON.parse(storedCart);
                updateCartCount();
            }
            
            // Set up menu option click handlers
            document.querySelectorAll('.menu-option').forEach(option => {
                option.addEventListener('click', function() {
                    showCustomizer(this.dataset.option);
                });
            });

            // Set up form validation
            setupFormValidation();
        }

        // Show login form
        function showLogin() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('signup-form').style.display = 'none';
            clearAuthErrors();
        }

        // Show signup form
        function showSignup() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
            clearAuthErrors();
        }

        // Clear auth form errors
        function clearAuthErrors() {
            document.querySelectorAll('#login-form .error-message, #signup-form .error-message').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('#login-form input, #signup-form input').forEach(input => {
                input.classList.remove('error');
            });
        }

        // Validate login form
        function validateLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            let isValid = true;
            
            // Reset errors
            document.getElementById('login-email-error').style.display = 'none';
            document.getElementById('login-password-error').style.display = 'none';
            document.getElementById('login-email').classList.remove('error');
            document.getElementById('login-password').classList.remove('error');
            
            // Validate email
            if (!email) {
                document.getElementById('login-email-error').style.display = 'block';
                document.getElementById('login-email').classList.add('error');
                isValid = false;
            }
            
            // Validate password
            if (!password) {
                document.getElementById('login-password-error').style.display = 'block';
                document.getElementById('login-password').classList.add('error');
                isValid = false;
            }
            
            return isValid;
        }

        // Login function
        function login() {
            if (!validateLogin()) return;
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Find user
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('healthyDelightsUser', JSON.stringify(user));
                showMainContent();
            } else {
                alert('Invalid email or password');
            }
        }

        // Validate signup form
        function validateSignup() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            let isValid = true;
            
            // Reset errors
            document.querySelectorAll('#signup-form .error-message').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('#signup-form input').forEach(input => {
                input.classList.remove('error');
            });
            
            // Validate name
            if (!name) {
                document.getElementById('signup-name-error').style.display = 'block';
                document.getElementById('signup-name').classList.add('error');
                isValid = false;
            }
            
            // Validate email
            if (!email) {
                document.getElementById('signup-email-error').style.display = 'block';
                document.getElementById('signup-email').classList.add('error');
                isValid = false;
            } else if (!email.includes('@')) {
                document.getElementById('signup-email-error').textContent = 'Please enter a valid email';
                document.getElementById('signup-email-error').style.display = 'block';
                document.getElementById('signup-email').classList.add('error');
                isValid = false;
            }
            
            // Validate password
            if (!password) {
                document.getElementById('signup-password-error').style.display = 'block';
                document.getElementById('signup-password').classList.add('error');
                isValid = false;
            } else if (password.length < 6) {
                document.getElementById('signup-password-error').textContent = 'Password must be at least 6 characters';
                document.getElementById('signup-password-error').style.display = 'block';
                document.getElementById('signup-password').classList.add('error');
                isValid = false;
            }
            
            // Validate confirm password
            if (password !== confirmPassword) {
                document.getElementById('signup-confirm-password-error').style.display = 'block';
                document.getElementById('signup-confirm-password').classList.add('error');
                isValid = false;
            }
            
            return isValid;
        }

        // Signup function
        function signup() {
            if (!validateSignup()) return;
            
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            // Check if user already exists
            const userExists = users.some(u => u.email === email);
            if (userExists) {
                alert('User with this email already exists');
                return;
            }
            
            // Create new user
            const newUser = {
                name,
                email,
                password,
                orders: []
            };
            
            users.push(newUser);
            currentUser = newUser;
            localStorage.setItem('healthyDelightsUser', JSON.stringify(newUser));
            showMainContent();
        }

        // Show main content after login/signup
        function showMainContent() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('user-info').style.display = 'flex';
            document.getElementById('cart-btn').style.display = 'flex';
            document.getElementById('username-display').textContent = currentUser.name;
            
            // Load user's order history
            if (currentUser.orders) {
                orderHistory = currentUser.orders;
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('healthyDelightsUser');
            document.getElementById('main-content').style.display = 'none';
            document.getElementById('auth-section').style.display = 'flex';
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('cart-btn').style.display = 'none';
            showLogin();
        }

        // Set up form validation
        function setupFormValidation() {
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            
            // Email validation
            emailInput.addEventListener('input', function() {
                validateEmail(this);
            });
            
            // Phone validation
            phoneInput.addEventListener('input', function() {
                validatePhone(this);
            });
        }

        // Validate email format
        function validateEmail(input) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const isValid = emailRegex.test(input.value);
            
            if (isValid || input.value === '') {
                input.classList.remove('error');
                document.getElementById('email-error').style.display = 'none';
            } else {
                input.classList.add('error');
                document.getElementById('email-error').style.display = 'block';
            }
            
            return isValid;
        }

        // Validate phone number (at least 10 digits)
        function validatePhone(input) {
            // Remove all non-digit characters
            const digits = input.value.replace(/\D/g, '');
            const isValid = digits.length >= 10;
            
            if (isValid || input.value === '') {
                input.classList.remove('error');
                document.getElementById('phone-error').style.display = 'none';
            } else {
                input.classList.add('error');
                document.getElementById('phone-error').style.display = 'block';
            }
            
            return isValid;
        }

        // Show the customizer for a specific meal type
        function showCustomizer(mealType) {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('cart-section').style.display = 'none';
            document.getElementById(`${mealType}-customizer`).style.display = 'flex';
            currentOrderType = mealType;
            
            // Render the ingredients for this meal type
            renderIngredients(mealType);
            updateSummary(mealType);
        }

        // Go back to the main menu
        function backToMenu() {
            // Hide all customizers and checkout
            document.querySelectorAll('.container').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('checkout-section').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('order-history-section').style.display = 'none';
            document.getElementById('cart-section').style.display = 'none';
            
            // Show main menu
            document.getElementById('main-menu').style.display = 'flex';
        }

        // Render ingredients for a specific meal type
        function renderIngredients(mealType) {
            const categories = Object.keys(ingredientsData[mealType]);
            
            categories.forEach(category => {
                const containerEl = document.getElementById(`${mealType}-${category}`);
                if (!containerEl) return;
                
                containerEl.innerHTML = '';
                
                ingredientsData[mealType][category].forEach(item => {
                    const isSelected = selectedItems[mealType][category].some(
                        selected => selected.name === item.name
                    );
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = `option ${isSelected ? 'selected' : ''} tooltip`;
                    itemEl.innerHTML = `
                        ${item.name} 
                        ${isSelected ? '<button class="remove-btn">×</button>' : ''}
                        <span class="calorie-info">(${item.calories} cal)</span>
                        <span class="tooltiptext">
                            <strong>Nutrition per serving:</strong><br>
                            Protein: ${item.protein}g<br>
                            Sugar: ${item.sugar}g<br>
                            <strong>Benefits:</strong> ${item.benefits}
                        </span>
                    `;
                    
                    itemEl.addEventListener('click', () => {
                        toggleIngredient(mealType, category, item);
                    });
                    
                    if (isSelected) {
                        const removeBtn = itemEl.querySelector('.remove-btn');
                        removeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleIngredient(mealType, category, item);
                        });
                    }
                    
                    containerEl.appendChild(itemEl);
                });
            });
        }

        // Toggle ingredient selection
        function toggleIngredient(mealType, category, item) {
            const index = selectedItems[mealType][category].findIndex(
                selected => selected.name === item.name
            );
            
            if (index === -1) {
                // For base fruits in smoothie, limit to 2 selections
                if (mealType === 'smoothie' && category === 'baseFruits' && 
                    selectedItems[mealType][category].length >= 2) {
                    return;
                }
                // For protein base in protein shake, limit to 1 selection
                if (mealType === 'proteinShake' && category === 'proteinBase' && 
                    selectedItems[mealType][category].length >= 1) {
                    return;
                }
                // For greens in salad, limit to 1 selection
                if (mealType === 'salad' && category === 'greens' && 
                    selectedItems[mealType][category].length >= 1) {
                    return;
                }
                
                selectedItems[mealType][category].push(item);
            } else {
                selectedItems[mealType][category].splice(index, 1);
            }
            
            renderIngredients(mealType);
            updateSummary(mealType);
        }

        // Update the summary section
        function updateSummary(mealType) {
            let summaryHTML = '';
            let totalCalories = 0;
            let totalPrice = 0;
            let totalProtein = 0;
            let totalSugar = 0;
            
            // Process each category
            for (const category in selectedItems[mealType]) {
                const items = selectedItems[mealType][category];
                if (items.length > 0) {
                    // Format category name for display
                    let displayCategory = category.replace(/([A-Z])/g, ' $1');
                    displayCategory = displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1);
                    
                    summaryHTML += `<h3>${displayCategory}</h3>`;
                    
                    items.forEach(item => {
                        summaryHTML += `
                            <div class="summary-item">
                                <span>${item.name}</span>
                                <span class="price">${formatPrice(item.price)}</span>
                            </div>
                            <div class="nutrition-info">
                                Protein: ${item.protein}g | Sugar: ${item.sugar}g
                            </div>
                        `;
                        totalCalories += item.calories;
                        totalPrice += item.price;
                        totalProtein += item.protein;
                        totalSugar += item.sugar;
                    });
                }
            }
            
            if (summaryHTML === '') {
                summaryHTML = `<p>Select ingredients to build your ${mealType.replace('-', ' ')}</p>`;
            }
            
            document.getElementById(`${mealType}-summary`).innerHTML = summaryHTML;
            
            // Update nutrition summary
            let nutritionHTML = '';
            if (totalCalories > 0) {
                nutritionHTML = `
                    <div class="nutrition-info">
                        <strong>Total Nutrition:</strong><br>
                        Calories: ${totalCalories}<br>
                        Protein: ${totalProtein.toFixed(1)}g<br>
                        Sugar: ${totalSugar.toFixed(1)}g
                    </div>
                `;
            }
            document.getElementById(`${mealType}-nutrition`).innerHTML = nutritionHTML;
            
            document.getElementById(`${mealType}-total-price`).textContent = formatPrice(totalPrice);
            
            // Save current order
            currentOrder = {
                type: mealType,
                items: JSON.parse(JSON.stringify(selectedItems[mealType])), // Deep copy
                calories: totalCalories,
                protein: totalProtein,
                sugar: totalSugar,
                price: totalPrice
            };
        }

        // Add item to cart
        function addToCart(mealType) {
            if (currentOrder.price === 0) {
                alert('Please select at least one ingredient');
                return;
            }
            
            // Add to cart
            cart.push({
                ...currentOrder,
                id: Date.now() // Unique ID for each cart item
            });
            
            // Save cart to localStorage
            localStorage.setItem('healthyDelightsCart', JSON.stringify(cart));
            
            // Update cart count
            updateCartCount();
            
            // Show success message
            alert('Item added to cart!');
            
            // Reset selections for this meal type
            for (const category in selectedItems[mealType]) {
                selectedItems[mealType][category] = [];
            }
            
            // Update summary
            updateSummary(mealType);
            renderIngredients(mealType);
        }

        // Update cart count
        function updateCartCount() {
            document.getElementById('cart-count').textContent = cart.length;
        }

        // Show cart
        function showCart() {
            document.getElementById('main-menu').style.display = 'none';
            document.querySelectorAll('.container').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('cart-section').style.display = 'block';
            
            renderCart();
        }

        // Render cart items
        function renderCart() {
            const cartItemsEl = document.getElementById('cart-items');
            
            if (cart.length === 0) {
                cartItemsEl.innerHTML = '<p class="cart-empty">Your cart is empty. Add some items to get started!</p>';
                document.getElementById('cart-total-price').textContent = formatPrice(0);
                return;
            }
            
            cartItemsEl.innerHTML = '';
            let totalPrice = 0;
            
            cart.forEach((item, index) => {
                totalPrice += item.price;
                
                const itemEl = document.createElement('div');
                itemEl.className = 'cart-item';
                
                let detailsHTML = '';
                for (const category in item.items) {
                    const items = item.items[category];
                    if (items.length > 0) {
                        // Format category name for display
                        let displayCategory = category.replace(/([A-Z])/g, ' $1');
                        displayCategory = displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1);
                        
                        detailsHTML += `<p><strong>${displayCategory}:</strong> `;
                        detailsHTML += items.map(i => i.name).join(', ');
                        detailsHTML += `</p>`;
                    }
                }
                
                itemEl.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.type.replace('-', ' ').charAt(0).toUpperCase() + item.type.replace('-', ' ').slice(1)}</div>
                        <div class="cart-item-details">
                            ${detailsHTML}
                            <p><strong>Nutrition:</strong> ${item.calories} cal, ${item.protein.toFixed(1)}g protein, ${item.sugar.toFixed(1)}g sugar</p>
                        </div>
                    </div>
                    <div class="cart-item-price">${formatPrice(item.price)}</div>
                    <button class="cart-item-remove" onclick="removeFromCart(${index})">×</button>
                `;
                
                cartItemsEl.appendChild(itemEl);
            });
            
            document.getElementById('cart-total-price').textContent = formatPrice(totalPrice);
        }

        // Remove item from cart
        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('healthyDelightsCart', JSON.stringify(cart));
            updateCartCount();
            renderCart();
        }

        // Checkout from cart
        function checkoutFromCart() {
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            
            // Calculate total price
            let totalPrice = 0;
            let totalCalories = 0;
            let totalProtein = 0;
            let totalSugar = 0;
            
            cart.forEach(item => {
                totalPrice += item.price;
                totalCalories += item.calories;
                totalProtein += item.protein;
                totalSugar += item.sugar;
            });
            
            // Create combined order
            currentOrder = {
                type: 'multiple',
                items: cart,
                calories: totalCalories,
                protein: totalProtein,
                sugar: totalSugar,
                price: totalPrice
            };
            
            // Show checkout section
            document.getElementById('cart-section').style.display = 'none';
            document.getElementById('checkout-section').style.display = 'block';
            
            // Build order summary
            let orderSummaryHTML = `<h3>Your Order (${cart.length} items)</h3>`;
            
            cart.forEach((item, index) => {
                orderSummaryHTML += `<h4>${index + 1}. ${item.type.replace('-', ' ').charAt(0).toUpperCase() + item.type.replace('-', ' ').slice(1)}</h4>`;
                
                for (const category in item.items) {
                    const items = item.items[category];
                    if (items.length > 0) {
                        // Format category name for display
                        let displayCategory = category.replace(/([A-Z])/g, ' $1');
                        displayCategory = displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1);
                        
                        orderSummaryHTML += `<p><strong>${displayCategory}:</strong></p><ul>`;
                        
                        items.forEach(item => {
                            orderSummaryHTML += `<li>${item.name} - ${formatPrice(item.price)} (${item.calories} cal, ${item.protein}g protein, ${item.sugar}g sugar)</li>`;
                        });
                        
                        orderSummaryHTML += `</ul>`;
                    }
                }
                
                orderSummaryHTML += `<p><strong>Item Nutrition:</strong> ${item.calories} cal, ${item.protein.toFixed(1)}g protein, ${item.sugar.toFixed(1)}g sugar</p>`;
                orderSummaryHTML += `<p><strong>Item Price:</strong> ${formatPrice(item.price)}</p>`;
            });
            
            orderSummaryHTML += `
                <div class="total">
                    <span>Total Nutrition:</span>
                    <span>${totalCalories} cal, ${totalProtein.toFixed(1)}g protein, ${totalSugar.toFixed(1)}g sugar</span>
                </div>
                <div class="total">
                    <span>Total Price:</span>
                    <span class="price">${formatPrice(totalPrice)}</span>
                </div>
            `;
            
            document.getElementById('order-summary').innerHTML = orderSummaryHTML;
        }

        // Show checkout section
        function showCheckout(mealType) {
            if (currentOrder.price === 0) {
                alert('Please select at least one ingredient');
                return;
            }
            
            // Hide current customizer
            document.getElementById(`${mealType}-customizer`).style.display = 'none';
            
            // Show checkout section
            document.getElementById('checkout-section').style.display = 'block';
            
            // Build order summary
            let orderSummaryHTML = `<h3>Your Custom ${mealType.replace('-', ' ').charAt(0).toUpperCase() + mealType.replace('-', ' ').slice(1)}</h3>`;
            
            for (const category in currentOrder.items) {
                const items = currentOrder.items[category];
                if (items.length > 0) {
                    // Format category name for display
                    let displayCategory = category.replace(/([A-Z])/g, ' $1');
                    displayCategory = displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1);
                    
                    orderSummaryHTML += `<p><strong>${displayCategory}:</strong></p><ul>`;
                    
                    items.forEach(item => {
                        orderSummaryHTML += `<li>${item.name} - ${formatPrice(item.price)} (${item.calories} cal, ${item.protein}g protein, ${item.sugar}g sugar)</li>`;
                    });
                    
                    orderSummaryHTML += `</ul>`;
                }
            }
            
            orderSummaryHTML += `
                <div class="total">
                    <span>Total Nutrition:</span>
                    <span>${currentOrder.calories} cal, ${currentOrder.protein.toFixed(1)}g protein, ${currentOrder.sugar.toFixed(1)}g sugar</span>
                </div>
                <div class="total">
                    <span>Total Price:</span>
                    <span class="price">${formatPrice(currentOrder.price)}</span>
                </div>
            `;
            
            document.getElementById('order-summary').innerHTML = orderSummaryHTML;
        }

        // Submit order
        function submitOrder() {
            // Validate form
            const form = document.getElementById('checkout-form');
            const inputs = form.querySelectorAll('input, select');
            let isValid = true;
            
            // Reset all error states
            inputs.forEach(input => {
                input.classList.remove('error');
                const errorId = `${input.id}-error`;
                if (document.getElementById(errorId)) {
                    document.getElementById(errorId).style.display = 'none';
                }
            });
            
            // Validate each field
            inputs.forEach(input => {
                if (!input.value) {
                    input.classList.add('error');
                    const errorId = `${input.id}-error`;
                    if (document.getElementById(errorId)) {
                        document.getElementById(errorId).style.display = 'block';
                    }
                    isValid = false;
                }
            });
            
            // Special validation for email and phone
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            
            if (emailInput.value && !validateEmail(emailInput)) {
                isValid = false;
            }
            
            if (phoneInput.value && !validatePhone(phoneInput)) {
                isValid = false;
            }
            
            if (!isValid) {
                alert('Please fill in all required fields correctly');
                return;
            }
            
            // Create order data
            const orderData = {
                customer: {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value
                },
                payment: document.getElementById('payment').value,
                order: currentOrder,
                date: new Date().toISOString()
            };
            
            console.log('Order submitted:', orderData); // For demonstration
            
            // Add to order history
            const orderHistoryItem = {
                type: currentOrder.type,
                items: JSON.parse(JSON.stringify(currentOrder.items)), // Deep copy
                calories: currentOrder.calories,
                protein: currentOrder.protein,
                sugar: currentOrder.sugar,
                price: currentOrder.price,
                date: orderData.date
            };
            
            orderHistory.unshift(orderHistoryItem);
            
            // Update user's orders in the database
            if (currentUser) {
                currentUser.orders.unshift(orderHistoryItem);
                localStorage.setItem('healthyDelightsUser', JSON.stringify(currentUser));
                
                // Update the users array (in a real app, this would be a server call)
                const userIndex = users.findIndex(u => u.email === currentUser.email);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                }
            }
            
            // Clear cart if this was a cart checkout
            if (currentOrder.type === 'multiple') {
                cart = [];
                localStorage.removeItem('healthyDelightsCart');
                updateCartCount();
            }
            
            // Show success message
            document.getElementById('checkout-section').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
            
            // Reset form
            form.reset();
            
            // Reset selected items for the current order type
            if (currentOrder.type !== 'multiple') {
                for (const category in selectedItems[currentOrderType]) {
                    selectedItems[currentOrderType][category] = [];
                }
            }
        }

        // Show order history
        function showOrderHistory() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('order-history-section').style.display = 'block';
            renderOrderHistory();
        }

        // Render order history
        function renderOrderHistory() {
            const historyList = document.getElementById('order-history-list');
            
            if (orderHistory.length === 0) {
                historyList.innerHTML = '<p class="no-orders">No orders yet. Place an order to see it here!</p>';
                return;
            }
            
            historyList.innerHTML = '';
            
            orderHistory.forEach((order, index) => {
                const orderDate = new Date(order.date).toLocaleString();
                const orderEl = document.createElement('div');
                orderEl.className = 'order-history-item';
                
                let itemsHTML = '';
                if (order.type === 'multiple') {
                    // Multiple items order (from cart)
                    itemsHTML += `<p><strong>Items:</strong> ${order.items.length}</p>`;
                    order.items.forEach((item, i) => {
                        itemsHTML += `<h4>${i + 1}. ${item.type.replace('-', ' ').charAt(0).toUpperCase() + item.type.replace('-', ' ').slice(1)}</h4>`;
                        
                        for (const category in item.items) {
                            const items = item.items[category];
                            if (items.length > 0) {
                                // Format category name for display
                                let displayCategory = category.replace(/([A-Z])/g, ' $1');
                                displayCategory = displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1);
                                
                                itemsHTML += `<p><strong>${displayCategory}:</strong></p><ul>`;
                                
                                items.forEach(item => {
                                    itemsHTML += `<li>${item.name} - ${formatPrice(item.price)} (${item.calories} cal, ${item.protein}g protein, ${item.sugar}g sugar)</li>`;
                                });
                                
                                itemsHTML += `</ul>`;
                            }
                        }
                        
                        itemsHTML += `<p><strong>Item Nutrition:</strong> ${item.calories} cal, ${item.protein.toFixed(1)}g protein, ${item.sugar.toFixed(1)}g sugar</p>`;
                        itemsHTML += `<p><strong>Item Price:</strong> ${formatPrice(item.price)}</p>`;
                    });
                } else {
                    // Single item order
                    for (const category in order.items) {
                        const items = order.items[category];
                        if (items.length > 0) {
                            // Format category name for display
                            let displayCategory = category.replace(/([A-Z])/g, ' $1');
                            displayCategory = displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1);
                            
                            itemsHTML += `<p><strong>${displayCategory}:</strong></p><ul>`;
                            
                            items.forEach(item => {
                                itemsHTML += `<li>${item.name} - ${formatPrice(item.price)} (${item.calories} cal, ${item.protein}g protein, ${item.sugar}g sugar)</li>`;
                            });
                            
                            itemsHTML += `</ul>`;
                        }
                    }
                }
                
                orderEl.innerHTML = `
                    <h3>Order #${index + 1} - ${orderDate}</h3>
                    <p><strong>Type:</strong> ${order.type === 'multiple' ? 'Multiple Items' : order.type.replace('-', ' ').charAt(0).toUpperCase() + order.type.replace('-', ' ').slice(1)}</p>
                    ${itemsHTML}
                    <p><strong>Total Nutrition:</strong> ${order.calories} cal, ${order.protein.toFixed(1)}g protein, ${order.sugar.toFixed(1)}g sugar</p>
                    <p><strong>Total Price:</strong> <span class="price">${formatPrice(order.price)}</span></p>
                `;
                
                historyList.appendChild(orderEl);
            });
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>